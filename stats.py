# ==============================
# ๐ AutoLearn Stats Viewer
# ูุนุฑุถ ุนุฏุฏ ุงููุณุชูุฏุงุช ูุงูููุงุทุน ูุงููุนุงุฑู ูุญุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช
# ูุนูู ุชููุงุฆููุง ูุน Render ุฃู ูุญูููุง
# ==============================

import sqlite3, os

# ุชุญุฏูุฏ ูุณุงุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงููุชุบูุฑ ุงูุจูุฆู ุฃู ุงูุงูุชุฑุงุถู
DB_PATH = os.getenv("AUTOLEARN_DB", "/data/autolearn.db")

def main():
    print("๐ก ูุญุต ุญุงูุฉ ูุงุนุฏุฉ ุจูุงูุงุช AutoLearn...\n")

    # ุชุญูู ูู ูุฌูุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช
    if not os.path.exists(DB_PATH):
        print(f"โ ูุง ููุฌุฏ ููู ูุงุนุฏุฉ ุจูุงูุงุช ูู ุงููุณุงุฑ: {DB_PATH}")
        print("๐ก ุฑุจูุง ูู ูุชู ุชุดุบูู ุงููุธุงู ุจุนุฏ ุฃู ูู ุชููุดุฃ ุงููุงุนุฏุฉ.")
        return

    # ุญุฌู ุงูููู ุจุงูููุบุงุจุงูุช
    size_mb = os.path.getsize(DB_PATH) / (1024 * 1024)

    # ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
    try:
        con = sqlite3.connect(DB_PATH)
        cur = con.cursor()
    except Exception as e:
        print(f"โ๏ธ ุฎุทุฃ ูู ูุชุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช: {e}")
        return

    stats = {}
    tables = ["docs", "chunks", "insights"]

    for t in tables:
        try:
            count = cur.execute(f"SELECT COUNT(*) FROM {t}").fetchone()[0]
            stats[t] = count
        except Exception:
            stats[t] = "โ (ุงูุฌุฏูู ุบูุฑ ููุฌูุฏ ุจุนุฏ)"

    con.close()

    # ุนุฑุถ ุงููุชุงุฆุฌ
    print("========== ๐ ุฅุญุตุงุกุงุช ูุงุนุฏุฉ ุจูุงูุงุช AutoLearn ==========")
    print(f"๐ฆ ุญุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช: {size_mb:.2f} MB")
    print(f"๐ ุนุฏุฏ ุงููุณุชูุฏุงุช (docs): {stats['docs']}")
    print(f"๐ ุนุฏุฏ ุงูููุงุทุน (chunks): {stats['chunks']}")
    print(f"๐ก ุนุฏุฏ ุงููุนุงุฑู (insights): {stats['insights']}")
    print("========================================================")

if __name__ == "__main__":
    main()
