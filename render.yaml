services:
  # ===== لوحة الإحصائيات (ويب) =====
  - type: web
    name: autolearn-dashboard
    env: python
    plan: starter
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
    startCommand: uvicorn stats_web:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: AUTOLEARN_DB
        value: /data/autolearn.db
      - key: STATS_PORT
        value: $PORT
    disks:
      - name: data
        mountPath: /data
        sizeGB: 2

  # ===== العامل الدائم (يتعلّم تلقائياً) =====
  - type: worker
    name: autolearn-core
    env: python
    plan: starter
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
    startCommand: python autolearn.py
    envVars:
      - key: AUTOLEARN_DB
        value: /data/autolearn.db
      - key: HF_HOME
        value: /data/hf_cache
      - key: SENTENCE_TRANSFORMERS_HOME
        value: /data/st_cache
    disks:
      - name: data
        mountPath: /data
        sizeGB: 4
