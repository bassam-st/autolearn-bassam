services:
  # ==========================
  # ğŸŒ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© (Dashboard)
  # ==========================
  - type: web
    name: autolearn-dashboard
    env: python
    plan: free
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
    startCommand: uvicorn stats_web:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: AUTOLEARN_DB
        value: /data/autolearn.db
      - key: STATS_PORT
        value: $PORT
    disks:
      - name: data
        mountPath: /data
        sizeGB: 2

  # ==========================
  # ğŸ§  Ù†ÙˆØ§Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ (Core)
  # ==========================
  - type: worker
    name: autolearn-core
    env: python
    plan: starter   # Ù„ØªØ¹Ù…Ù„ 24/7ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡Ø§ Ø¥Ù„Ù‰ free Ù…Ø¤Ù‚ØªÙ‹Ø§
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
    startCommand: uvicorn autolearn:app --host 0.0.0.0 --port 10000
    envVars:
      - key: AUTOLEARN_DB
        value: /data/autolearn.db
      - key: HF_HOME
        value: /data/hf_cache
      - key: SENTENCE_TRANSFORMERS_HOME
        value: /data/st_cache
      - key: LANGUAGE
        value: ar
      - key: LOG_LEVEL
        value: info
      - key: AUTONOMOUS_MODE
        value: true
      - key: UPDATE_INTERVAL
        value: 5
      # Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© (Ø£Ø²Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¹Ù†Ù‡Ø§ Ø¥Ù† Ø£Ø±Ø¯Øª Ø§Ù„ØªÙØ¹ÙŠÙ„)
      # - key: OPENAI_API_KEY
      #   sync: false
      # - key: GEMINI_API_KEY
      #   sync: false
    disks:
      - name: data
        mountPath: /data
        sizeGB: 2

  # ==========================
  # ğŸ“° ÙˆØ­Ø¯Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙˆØ§Ù„Ù…Ø¹Ø±ÙØ© (News Worker)
  # ==========================
  - type: worker
    name: autolearn-news
    env: python
    plan: starter
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
    startCommand: python news_worker.py
    envVars:
      - key: AUTOLEARN_DB
        value: /data/autolearn.db
      - key: LANGUAGE
        value: ar
      - key: UPDATE_INTERVAL
        value: 60
    disks:
      - name: data
        mountPath: /data
        sizeGB: 2
